!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Erebus=t()}(this,(function(){"use strict";const e={};function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}e.isPromise=function(e){return!!e&&(e instanceof Promise||typeof("function"===e.then)&&"function"==typeof e.catch)},e.trim=function(e){return"string"!=typeof e?e:e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};var n={tinyId:t,shortId:function(){return t()+t()},guid:function(){return t()+"-"+t()+"-"+t()+"-"+t()+t()}};var r={onReady:function(e){"loading"!==document.readyState?e():"function"==typeof document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):"function"==typeof document.attachEvent&&document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&e()}))}};var o={trigger:function(e,...t){if(null!=e){if("function"!=typeof e)throw new Error("erebus.handler.trigger.invalid_function");try{return e.call(null,...t)}catch(e){throw new Error("erebus.handlers.trigger.function_error",e)}}},triggerAsPromise:function(e,...t){return null==e?Promise.resolve():"function"!=typeof e?Promise.reject("erebus.handler.trigger_promise_function.invalid_function"):new Promise((function(n,r){try{n(e.call(null,...t))}catch(e){console.error("erebus.handlers.trigger_promise_function.function_error",e),r(e)}}))}};const i={};function s(e){if(!e||"string"!=typeof e)return[];const t=document.createElement("div");return t.innerHTML=e,[...t.childNodes]}function a(e){if(e&&e instanceof HTMLElement)for(;e.firstChild;)e.removeChild(e.firstChild)}function l(e){if(!(e&&e instanceof HTMLElement))return null;const t=e.cloneNode(!0);return 1===t.nodeType&&t.removeAttribute("id"),t}function u(e){if(!e)return null;if(e instanceof c)return e;if("body"===e||e===document.body)return i.body||(i.body=new c(document.body)),i.body;if(e instanceof HTMLElement)return new c(e);if("string"==typeof e){var t;if(e.startsWith("<")&&e.endsWith(">"))t=s(e);else if(e.startsWith("#")){if(!(t=document.getElementById(e.substring(1))))throw Error("erebus.element.unknown_element_id["+e+"]")}else if(0===(t=document.querySelectorAll(e)).length)throw Error("erebus.element.unknown_selector["+e+"]");return new c(t)}}class c{#e;#t;constructor(e){if(this.#t=!1,e instanceof HTMLElement)this.#e=[],this.#e.push(e);else if(e instanceof NodeList)this.#e=Array.from(e);else{if(!Array.isArray(e))throw Error("erebus.element.unknown_type["+typeof e+"]");this.#e=e}}each(e){for(let t=0;t<this.#e.length;t++){if(!1===e(this.#e[t],t))break}}set innerHTML(e){this.each((t=>{t.innerHTML=e}))}clear(){return this.each((e=>{e.innerHTML="",a(e)})),this}content(e){return this.each(((t,n)=>{"string"==typeof e?t.innerHTML=e:e instanceof HTMLElement?(t.innerHTML="",a(t),0===n?t.appendChild(e):t.appendChild(l(e))):e instanceof c&&(t.innerHTML="",a(t),0===n?e.setParentNode(t):e.clone().setParentNode(t))})),this}setParentNode(e){if(!e)return this.each((e=>{e.parentNode.removeChild(e)})),this;if("string"==typeof e)e=u(e);else if("function"!=typeof e.appendChild)throw Error("erebus.wrapper.append_to.invalid_parent["+typeof e+"]");return this.each((t=>{e.appendChild(t)})),this}set parentNode(e){this.setParentNode(e)}appendChild(e){if("string"==typeof e){const t=s(e);this.each(((e,n)=>{for(let r=0;r<t.length;r++){const o=t[r];0===n?e.appendChild(o):e.appendChild(l(o))}}))}else this.each(((t,n)=>{e instanceof HTMLElement?0===n?t.appendChild(e):t.appendChild(l(e)):e instanceof c&&e.each((e=>{0===n?t.appendChild(e):t.appendChild(l(e))}))}));return this}addEventListener(e,t,n){if(!e)throw Error("erebus.element.add_listener.null_event_name");return"function"==typeof t&&(void 0===n&&(n={capture:!1}),this.each((r=>{r.addEventListener(e,t,n)}))),this}once(e,t){return this.addEventListener(e,t,{capture:!1,once:!0})}get isHidden(){return this.#t}hide(){this.#t||(this.#t=!0,this.each((e=>{const t=getComputedStyle(e).getPropertyValue("display");t&&"none"!==t&&(e.originalDisplay=t),e.style.display="none"})))}show(){this.#t=!1,this.each((e=>{const t=getComputedStyle(e).getPropertyValue("display");t&&"none"!==t||(e.originalDisplay?(e.style.display=e.originalDisplay,delete e.originalDisplay):e.style.display="block")}))}clone(){const e=[];return this.each((t=>{e.push(l(t))})),new c(e)}addClass(...t){return t&&0!==t.length?(this.each((n=>{for(var r=0;r<t.length;r++){const o=e.trim(t[r]);if(o&&"string"==typeof o)if(n.className){new RegExp("(^|\\s)("+o+")($|\\s)","g").test(n.className)||(n.className+=" "+o)}else n.className=o}})),this):this}removeClass(...t){return t&&0!==t.length?(this.each((n=>{if(n.className)for(var r=0;r<t.length;r++){const o=e.trim(t[r]);if(!o||"string"!=typeof o)continue;const i=new RegExp("(^|\\s)("+o+")($|\\s)","g");i.test(n.className)&&(n.className=n.className.replace(i,""))}})),this):this}set className(t){t=e.trim(t),this.each((e=>{e.className=t}))}}const d={},f={};function p(t,n,r){return"string"==typeof n&&n?(r||(r={}),t||(t="GET"),new Promise((function(o,i){const s=function(){if(window.XMLHttpRequest)return new window.XMLHttpRequest;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){throw Error("erebus.http.xmlhttp_error")}}}();s.onreadystatechange=function(){if(4==s.readyState||"complete"===s.readyState)if(200!==s.status){const e=new Error("http_error["+s.status+"]");e.status=s.status,e.response=s.responseText,i(e)}else{var t=s.responseText;const n=function(t){const n={};let r=t.getAllResponseHeaders();if(r){r=r.split("\r\n");for(let t=0;t<r.length;t++){if(!r[t])continue;const o=r[t].split(":"),i=e.trim(o[0]).toLowerCase(),s=e.trim(o[1]);i&&s&&(n[i]=s)}}return n}(s),a=function(e){return e&&"application/json"===e["content-type"]?f.parsers.json:null}(n);if(a)try{t=a(t)}catch(e){return void i(e)}if("function"==typeof r.interceptor){const e=r.interceptor(t,n);void 0!==e&&(t=e)}o(t)}},s.open(t,n,!1!==r.async),function(e,t){if(t)for(var n in t)e.setRequestHeader(n,t[n])}(s,r.headers),"GET"!==t&&r.data?s.send(r.data):s.send()}))):Promise.reject("erebus.http.null_url")}f.parsers={},f.parsers.json=function(e){try{return JSON.parse(e)}catch(t){const n=new Error("erebus.http.json_parse_error");throw n.cause=t,n.response=e,n}},d.get=function(e,t){return p("GET",e,t)},d.post=function(e,t){return p("POST",e,t)},d.put=function(e,t){return p("PUT",e,t)},d.delete=function(e,t){return p("DELETE",e,t)},d.loadScript=function(e){return new Promise((t=>{var n=document.createElement("script");n.src=e,n.type="text/javascript",n.async=!1,n.onerror=()=>{},n.onload=()=>{t()},document.head.appendChild(n)}))};const h={};function g(){return navigator.language?navigator.language:navigator.browserLanguage?navigator.browserLanguage:"en-US"}function m(){return g().substr(0,2)}function y(){return h.language?h.language:m()}h.language=null,h.resources={};var v={getLocale:g,getSystemLanguage:m,setLanguage:function(e){h.language=e},getLanguage:y,setResourceBundle:function t(n,r){if(!n)return Promise.resolve();if(r||(r=y()),"function"==typeof n){return t(o.trigger(n),r)}if(e.isPromise(n))return n.then((function(e){return t(e,r)})).catch((function(e){const t=Error("erebus.i18n.promise_resource_error");throw t.cause=e,t}));const i=h.resources[r];return i?Object.assign(i,n):h.resources[r]=n,Promise.resolve()},getLabel:function(e,t){const n=y(),r=h.resources[n];return r&&r[e]?r[e]:t??e}};console.log("Erebus Core v0.0.10");var b={utils:e,random:n,events:r,handler:o,element:u,http:d,i18n:v};function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return t&&E(e.prototype,t),n&&E(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&L(e,t)}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},C(e)}function L(e,t){return L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},L(e,t)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return k(e)}function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=C(e);if(t){var o=C(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return M(this,n)}}function H(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,A(e,t,"get"))}function N(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,A(e,t,"set"),n),n}function A(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function O(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function R(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function j(e,t,n){R(e,t),t.set(e,n)}function S(e,t){R(e,t),t.add(e)}var q=T((function e(){w(this,e)}));function x(e,t){if(!e)throw Error("erebus.utils.append_to_body.null_element");if(document.body)return b.element(document.body).appendChild(e),void b.handler.trigger(t,e);b.events.onReady((function(){b.element(document.body).appendChild(e),b.handler.trigger(t,e)}))}function W(e,t,n){var r=document.createElement(e);return n&&r.setAttribute("id",n),t&&(r.className=t),r}function I(e,t,n){var r=W(e,t,n);return b.element(r)}function B(e,t,n){var r=document.getElementById(e);return r?b.element(r):I(t,n,e)}var D={appendToBody:x,createHTMLElement:W,createElement:I,getOrCreateElement:B,getOrRenderElement:function(e,t,n,r){var o=B(e,t,n);return x(o,r),o},copyAttribute:function e(t,n,r,o){if(!t||!n||!r)return!1;if(Array.isArray(n)){for(var i=0;i<n.length;i++)if(e(t,n[i],r,o))return!0;return!1}var s=n[r];return null!=s?(t[r]=s,!0):(o&&(t[r]=o),!1)}},F={singleton:null},V=new WeakMap,X=function(e){_(n,e);var t=P(n);function n(){var e;return w(this,n),j(k(e=t.call(this)),V,{writable:!0,value:void 0}),N(k(e),V,!1),e}return T(n,[{key:"render",value:function(e){if(H(this,V))return console.warn("erebus.components.surface.already_rendered"),b.handler.trigger(e),this;N(this,V,!0);var t=D.getOrCreateElement("divErbSurface","div","erb-surface");return D.appendToBody(t,e),this}}]),n}(q);function z(){return F.singleton||(F.singleton=new X),F.singleton}var G={singleton:null},$=new WeakMap,Q=new WeakMap,U=new WeakSet,Y=function(e){_(n,e);var t=P(n);function n(){var e;return w(this,n),S(k(e=t.call(this)),U),j(k(e),$,{writable:!0,value:void 0}),j(k(e),Q,{writable:!0,value:void 0}),N(k(e),Q,!1),e}return T(n,[{key:"render",value:function(e){if(H(this,$))return console.warn("erebus.components.protect.already_rendered"),b.handler.trigger(e),this;N(this,$,!0);var t=O(this,U,J).call(this);return D.appendToBody(t,e),this}},{key:"show",value:function(){if(H(this,$)){if(H(this,Q))return}else this.render();N(this,Q,!0),O(this,U,J).call(this).removeClass("erb-hidden")}},{key:"hide",value:function(){if(H(this,$)){if(!H(this,Q))return}else this.render();N(this,Q,!1),O(this,U,J).call(this).addClass("erb-hidden")}}]),n}(q);function J(){return D.getOrCreateElement("divErbProtect","div","erb-protect erb-hidden")}function K(){return G.singleton||(G.singleton=new Y),G.singleton}var Z={components:{}},ee=function(){function e(){w(this,e)}return T(e,[{key:"register",value:function(e,t){t?e?"function"==typeof t?Z.components[e]=t:console.warn("erebus.components.manager.register.no_component_builder["+e+"]"):console.warn("erebus.components.manager.register.no_component_name"):console.warn("erebus.components.manager.register.null_component")}},{key:"get",value:function(e,t){if(!e)throw Error("erebus.components.manager.get.no_component_name");if(!Z.components[e])throw Error("erebus.components.manager.get.unknown_component["+e+"]");return Z.components[e](t)}}]),e}();Z.singleton=new ee,Z.singleton.register("surface",z),Z.singleton.register("protect",K);var te=Z.singleton,ne={};function re(e){var t,n=D.createElement("div","erb-toast erb-"+e.type,e.id);if(n.appendChild('<div class="erb-icon"></div>'),!1!==e.title){var r,o=null!==(r=e.title)&&void 0!==r?r:(t=e.type,b.i18n.getLabel("toast.title."+t,t));n.appendChild('<div class="erb-header">'+o+"</div>")}return e.message&&n.appendChild('<div class="erb-body">'+e.message+"</div>"),D.getOrRenderElement("divErbToastHolder","div","erb-toast-holder").appendChild(n),n.addClass("erb-bouncein"),n.once("animationend",(function(){n.removeClass("erb-bouncein")})),n}ne.validTypes={info:"info",success:"success",warn:"warn",error:"error"};var oe=new WeakMap,ie=new WeakMap,se=function(e){_(n,e);var t=P(n);function n(e){var r;return w(this,n),j(k(r=t.call(this)),oe,{writable:!0,value:void 0}),j(k(r),ie,{writable:!0,value:void 0}),N(k(r),ie,e),H(k(r),ie).id="divErbToast_"+b.random.tinyId(),r}return T(n,[{key:"render",value:function(e){var t=this;return H(this,oe)?(console.warn("erebus.components.toast.already_rendered"),b.handler.trigger(e),this):(N(this,oe,!0),re(H(this,ie)).once("click",(function(){t.dismiss(!0)})),b.handler.trigger(e),this)}},{key:"dismiss",value:function(e){var t=this;!0===e?e=0:("number"!=typeof e||e<=0)&&(e=1e4),setTimeout((function(){var e=b.element("#"+H(t,ie).id);e.once("animationend",(function(){e.setParentNode(null)})),e.addClass("erb-bounceout")}),e)}}]),n}(q);function ae(){var e={};if(0===arguments.length)throw Error("erebus.components.toast.no_arguments");if(e.type=arguments[0],2===arguments.length?e.message=arguments[1]:arguments.length>2&&(e.title=arguments[1],e.message=arguments[2]),e.type){if(!ne.validTypes[e.type])throw Error("erebus.components.toast.invalid_type["+e.type+"]")}else e.type=ne.validTypes.info;if(!e.message)throw Error("erebus.components.toast.null_message");return e}var le=function(){var e=ae.apply(void 0,arguments);return new se(e).render()};le.info=function(){return le.apply(void 0,[ne.validTypes.info].concat(Array.prototype.slice.call(arguments)))},le.success=function(){return le.apply(void 0,[ne.validTypes.success].concat(Array.prototype.slice.call(arguments)))},le.warn=function(){return le.apply(void 0,[ne.validTypes.warn].concat(Array.prototype.slice.call(arguments)))},le.error=function(){return le.apply(void 0,[ne.validTypes.error].concat(Array.prototype.slice.call(arguments)))};var ue={};function ce(e){return b.i18n.getLabel("dialog.title."+e,e)}function de(e){if(0!==ue.queue.length){var t=ue.queue.findIndex((function(t){return t.id===e.id}));console.log("Searching dialog id="+e.id+" size="+ue.queue.length+" index="+t),t>=0&&(console.log("Removing dialog "+e.id),ue.queue.splice(t,1))}else console.log("Queue is empty. Nothing to remove. id="+e.id)}function fe(){console.log("Extracting next dialog. size="+ue.queue.length);var e=ue.queue.shift();return!!e&&(e.render(),!0)}ue.validTypes={info:"info",success:"success",warn:"warn",error:"error",confirm:"confirm"},ue.queue=[],ue.current=null,ue.element=null;var pe=new WeakMap,he=new WeakMap,ge=new WeakMap,me=new WeakSet,ye=new WeakSet,ve=new WeakSet,be=new WeakSet,we=function(e){_(n,e);var t=P(n);function n(e){var r;return w(this,n),S(k(r=t.call(this)),be),S(k(r),ve),S(k(r),ye),S(k(r),me),j(k(r),pe,{writable:!0,value:void 0}),j(k(r),he,{writable:!0,value:void 0}),j(k(r),ge,{writable:!0,value:void 0}),N(k(r),pe,!1),N(k(r),he,[]),N(k(r),ge,e),H(k(r),ge).id=b.random.tinyId(),console.log("Creating dialog id="+H(k(r),ge).id),r}return T(n,[{key:"id",get:function(){return H(this,ge).id}},{key:"_queue",value:function(){ue.current&&ue.current.id===this.id?(console.log("Returning dialog to the queue id="+this.id),ue.queue.unshift(this),N(this,pe,!1)):(console.log("Queuing dialog id="+this.id),ue.queue.push(this))}},{key:"render",value:function(e){var t=this;return H(this,pe)?(b.handler.trigger(e),this):(console.log("Rendering dialog id="+this.id),N(this,pe,!0),de(this),ue.current&&ue.current.id!==this.id&&ue.current._queue(),ue.current=this,O(this,ve,_e).call(this),K().show(),ue.element.addClass("erb-fadein"),D.appendToBody(ue.element,(function(){ue.element.once("animationend",(function(){ue.element.removeClass("erb-fadein"),b.handler.trigger(e,H(t,ge).closeValue)}))})),this)}},{key:"close",value:function(){var e=this,t=0,n=null;1===arguments.length?"number"==typeof arguments[0]?t=arguments[0]:"function"==typeof arguments[0]&&(n=arguments[0]):2===arguments.length&&(t=arguments[0],n=arguments[1]),t<0&&(t=0),setTimeout((function(){ue.current.id!==e.id?(console.log("Closing queued dialog id="+e.id),de(e),b.handler.trigger(n)):(console.log("Closing current dialog id="+e.id),ue.element.addClass("erb-fadeout"),ue.element.once("animationend",(function(){ue.current=null,ue.element.setParentNode(null),ue.element.removeClass("erb-fadeout"),setTimeout((function(){b.handler.trigger(n),O(e,be,Ce).call(e),fe()||K().hide()}),0)})))}),t)}},{key:"then",value:function(e){return"function"==typeof e&&H(this,he).push(e),this}}]),n}(q);function Ee(e,t,n){var r=D.createElement("div",e);return t&&r.content(t),!0===n?ue.element.content(r):ue.element.appendChild(r),r}function Te(){var e=this,t=O(this,me,Ee).call(this,"erb-footer");if("confirm"===H(this,ge).type){var n=D.createHTMLElement("button","erb-button erb-positive");n.innerHTML=b.i18n.getLabel("button.yes","Yes"),n.addEventListener("click",(function(){H(e,ge).closeValue=!0,e.close()})),t.appendChild(n);var r=D.createHTMLElement("button","erb-button erb-negative");r.innerHTML=b.i18n.getLabel("button.no","No"),r.addEventListener("click",(function(){H(e,ge).closeValue=!1,e.close()})),t.appendChild(r)}else{var o=D.createHTMLElement("button","erb-button erb-primary");o.innerHTML=b.i18n.getLabel("button.close","Close"),o.addEventListener("click",(function(){e.close()})),t.appendChild(o)}}function _e(){var e=this,t="erb-dialog erb-"+H(this,ge).type;ue.element?ue.element.className=t:ue.element=D.getOrCreateElement("divErbDialog","div",t),O(this,me,Ee).call(this,"erb-header",H(this,ge).title,!0),O(this,me,Ee).call(this,"erb-body",H(this,ge).message),O(this,me,Ee).call(this,"erb-close").once("click",(function(){e.close()})),O(this,ye,Te).call(this)}function Ce(){for(var e=0;e<H(this,he).length;e++)b.handler.trigger(H(this,he)[e],H(this,ge).closeValue)}function Le(){var e={};if(0===arguments.length)throw Error("erebus.components.dialog.no_arguments");if(e.type=arguments[0],2===arguments.length?e.message=arguments[1]:arguments.length>2&&(e.title=arguments[1],e.message=arguments[2]),e.type){if(!ue.validTypes[e.type])throw Error("erebus.components.dialog.invalid_type["+e.type+"]")}else e.type=ue.validTypes.info;if(e.title||(e.title=ce(e.type)),!e.message)throw Error("erebus.components.dialog.null_message");return e}var ke=function(){var e=Le.apply(void 0,arguments),t=new we(e);return ue.current?(t._queue(),t):t.render()};ke.info=function(){return ke.apply(void 0,[ue.validTypes.info].concat(Array.prototype.slice.call(arguments)))},ke.success=function(){return ke.apply(void 0,[ue.validTypes.success].concat(Array.prototype.slice.call(arguments)))},ke.warn=function(){return ke.apply(void 0,[ue.validTypes.warn].concat(Array.prototype.slice.call(arguments)))},ke.error=function(){return ke.apply(void 0,[ue.validTypes.error].concat(Array.prototype.slice.call(arguments)))},ke.confirm=function(){return ke.apply(void 0,[ue.validTypes.confirm].concat(Array.prototype.slice.call(arguments)))};var Me={erebus:"Erebus framework","toast.title.success":"Success","toast.title.info":"Information","toast.title.warn":"Attention!","toast.title.error":"Error!","button.close":"Close","button.yes":"Yes","button.no":"No"};console.log("Erebus Components v0.0.2");var Pe={onInit:[]};b.components={},b.components.get=te.get;var He=b.i18n.getLanguage();return b.i18n.setResourceBundle(Me,He),b.events.onReady((function(){window.surface=z(),window.protect=K().render(),window.toast=le,window.dialog=ke;for(var e=0;e<Pe.onInit.length;e++)b.handler.trigger(Pe.onInit[e])})),b.components.onReady=function(e){"function"==typeof e&&Pe.onInit.push(e)},b}));
//# sourceMappingURL=erebus-components.min.js.map
